<div
  class="relative w-screen h-screen bg-gradient-to-tl from-[#0f0f29] to-[#3b3b3b] overflow-hidden"
>
  <button
    class="absolute top-6 right-6 px-4 py-2 bg-[#8bb3ee] text-white rounded-lg shadow-md hover:bg-red-700 z-40"
    (click)="logout()"
  >
    Logout
  </button>
  <button
    class="absolute top-6 left-6 px-4 py-2 bg-[#8bb3ee] text-white rounded-lg shadow-md hover:bg-red-700 z-40"
    (click)="goToUsersList()"
  >
    Logout
  </button>

  <button
    class="absolute bottom-6 right-6 px-6 py-2 bg-[#8bb3ee] text-white font-semibold rounded-xl shadow-lg hover:bg-blue-700 transition-all z-40"
    (click)="openModal()"
  >
    + Add Card
  </button>

  <div
    *ngIf="currentUser"
    class="fixed top-1/2 left-6 transform -translate-y-1/2 w-64 bg-white/80 backdrop-blur-sm p-4 rounded-lg shadow-xl z-40 transition-transform duration-300 hover:scale-105"
  >
    <div class="cursor-pointer" (click)="goToUserProfile()">
      <div class="flex items-center gap-4 mb-4">
        <img
          *ngIf="currentUser.image; else placeholderImage"
          [src]="currentUser.image"
          alt="{{ currentUser.username }}'s profile picture"
          class="w-14 h-14 rounded-full object-cover border-2 border-[#0f0f29]"
        />
        <ng-template #placeholderImage>
          <div
            class="w-14 h-14 rounded-full bg-gray-300 flex items-center justify-center text-gray-600 text-xl font-semibold"
          >
            {{
              currentUser.username
                ? currentUser.username.charAt(0).toUpperCase()
                : "?"
            }}
          </div>
        </ng-template>

        <span class="text-[#0f0f29] font-bold text-lg">
          {{ currentUser.username }}
        </span>
      </div>

      <div class="text-center mt-2">
        <p class="text-sm text-gray-600">Current Balance:</p>
        <p class="text-2xl font-semibold text-[#200123]">
          {{ currentUser.balance | currency : "KWD" : "symbol" : "1.3-3" }}
        </p>
      </div>
    </div>
  </div>

  <div
    class="absolute top-1/2 right-[-140px] transform -translate-y-1/2 flex flex-col items-end gap-[-100px]"
  >
    <ng-container *ngFor="let card of cards(); let i = index">
      <div
        *ngIf="selectedCardIndex() !== i"
        class="transition-all duration-500 ease-in-out cursor-pointer relative -mt-24 hover:translate-x-[-20px]"
        (click)="selectCard(i)"
      >
        <app-payment-card
          [card]="card"
          [background]="card.background"
          [flipped]="false"
        />
      </div>
    </ng-container>
  </div>

  <div *ngIf="selectedCardIndex() !== null">
    <ng-container *ngIf="selectedCard() as selected">
      <div class="fixed left-1/2 top-20 transform -translate-x-1/2 z-30">
        <div class="animate-swipe-in">
          <app-payment-card
            [card]="selected"
            [background]="selected.background"
            [flipped]="false"
          />
        </div>
      </div>

      <div
        class="fixed left-1/2 top-[280px] mt-10 transform -translate-x-1/2 w-[30%] h-[50%] p-6 rounded-xl bg-white/70 shadow-xl text-center z-1 transition-all duration-700 ease-out"
      >
        <div class="h-10"></div>
        <p class="text-3xl font-bold mb-4 text-center text-[#200123]">
          Balance: {{ getSelectedBalance() }}
        </p>
        <div class="h-24"></div>

        <div class="flex items-center gap-4 justify-center mb-4">
          <input
            type="number"
            [(ngModel)]="transactionAmount"
            placeholder="Amount"
            class="p-2 mb-3 text-3xl border-b text-center italic border-[#200123]/70 bg-transparent text-[#200123] font-semibold placeholder-[#200123]/70 focus:outline-none"
          />
        </div>
        <div class="h-8"></div>
        <div class="flex justify-center gap-14">
          <button
            class="w-[30%] py-2 bg-[#200123] text-white font-semibold rounded-lg transition-transform duration-300 hover:scale-105"
            (click)="deposit(selectedCardIndex(), transactionAmount)"
          >
            Deposit
          </button>
          <button
            class="w-[30%] py-2 bg-[#8bb3ee] text-white font-semibold rounded-lg transition-transform duration-300 hover:scale-105"
            (click)="withdraw(selectedCardIndex(), transactionAmount)"
          >
            Withdraw
          </button>
        </div>
      </div>
    </ng-container>
  </div>

  <div
    *ngIf="toastMessage()"
    class="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-black text-white px-4 py-2 rounded shadow-lg z-50 animate-fade-in"
  >
    {{ toastMessage() }}
  </div>

  <app-add-card-modal
    *ngIf="showModal()"
    (save)="addCard($event)"
    (closeModal)="closeModal()"
  ></app-add-card-modal>
</div>
