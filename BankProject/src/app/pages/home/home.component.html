<div
  class="relative w-screen h-screen bg-gradient-to-tl from-[#000000] to-[#2b2b2c] overflow-hidden"
>
  <!-- WELCOME SECTION (hidden after card is selected) -->
  <div
    *ngIf="selectedCardIndex() === null"
    class="absolute top-10 left-28 z-50 mt-[300px]"
  >
    <h1 class="text-8xl font-extrabold text-[#ffffff]">
      WELCOME, {{ user?.username?.toUpperCase() }}
    </h1>
    <div class="flex justify-end items-center gap-4 mt-4">
      <span class="text-xl text-white font-medium">
        Start your transactions
      </span>

      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 14 14"
        width="48"
        height="48"
        class="text-[#ff411f]"
      >
        <g
          fill="none"
          stroke="currentColor"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <path d="m10.5 11.5l3-3l-3-3"></path>
          <path d="M.5 2.5v2a4 4 0 0 0 4 4h9"></path>
        </g>
      </svg>
    </div>
  </div>
  <!-- ADD CARD BUTTON -->

  <button
    class="absolute bottom-6 right-80 px-6 py-2 bg-[#ff411f] text-white font-semibold rounded-3xl shadow-lg transition-transform duration-300 hover:scale-105"
    (click)="openModal()"
  >
    + Add Digital Card
  </button>

  <!-- CARDS STACK AREA -->
  <div
    class="absolute top-1/2 right-[-140px] transform -translate-y-1/2 flex flex-col items-end gap-[-100px] z-20"
  >
    <ng-container *ngFor="let card of cards(); let i = index">
      <div
        *ngIf="selectedCardIndex() !== i"
        class="transition-all duration-500 ease-in-out cursor-pointer relative -mt-24 hover:translate-x-[-20px]"
        (click)="selectCard(i)"
      >
        <app-payment-card
          [card]="toPaymentCard(card)"
          [background]="card.background"
          [flipped]="false"
        />
      </div>
    </ng-container>
  </div>

  <!-- âœ… BLACK SIDEBAR BACKGROUND (BELOW CARDS) -->
  <div
    class="absolute top-0 right-0 w-[16%] h-[93.5%] bg-gradient-to-tl from-[#000000] to-[#2b2b2c] rounded-l-3xl mt-[4%] z-0"
  >
    <!-- <button
      class="absolute top-6 left-11 px-6 py-2 bg-[#ff411f] text-white font-semibold rounded-3xl shadow-lg transition-transform duration-300 hover:scale-105"
      (click)="openModal()"
    >
      + Create Digital Card
    </button> -->
  </div>

  <!-- SELECTED CARD DISPLAY + ACTIONS -->
  <div *ngIf="selectedCardIndex() !== null">
    <ng-container *ngIf="selectedCard() as selected">
      <!-- Swiped-In Selected Card -->
      <div class="fixed left-1/2 top-20 transform -translate-x-1/2 z-30">
        <div class="animate-swipe-in">
          <app-payment-card
            [card]="toPaymentCard(selected)"
            [background]="selected.background"
            [flipped]="false"
          />
        </div>
      </div>

      <!-- BALANCE AND ACTIONS CONTAINER -->
      <div
        class="fixed left-1/2 top-[280px] mt-7 transform -translate-x-1/2 w-[30%] bg-gradient-to-tl from-[#262626] to-[#2b2b2c] h-[65%] p-6 rounded-xl bg- shadow-xl text-center z-10 transition-all duration-700 ease-out"
      >
        <div class="h-10"></div>
        <p class="text-3xl font-bold mb-4 text-center text-[#ffffff]">
          Balance: {{ getSelectedBalance() | number : "1.3-3" }} KWD
        </p>
        <div class="h-10"></div>

        <div class="flex items-center gap-4 justify-center mb-2">
          <input
            type="number"
            [(ngModel)]="transactionAmount"
            placeholder="Amount"
            class="appearance-none w-full bg-[#323232] p-2 text-center font-semibold text-xl rounded-3xl text-[#ffffff]"
          />
        </div>

        <div class="h-8"></div>
        <div class="flex justify-center gap-14">
          <button
            class="w-[30%] py-2 bg-[#323132] text-white font-semibold shadow-md cursor-pointer rounded-3xl transition-transform duration-300 hover:scale-105"
            [disabled]="!transactionAmount"
            (click)="
              transactionAmount !== null &&
                deposit(selectedCardIndex(), transactionAmount)
            "
          >
            Deposit
          </button>
          <button
            class="w-[30%] py-2 bg-[#ff411f] shadow-md text-white font-semibold cursor-pointer rounded-3xl transition-transform duration-300 hover:scale-105"
            [disabled]="!transactionAmount"
            (click)="
              transactionAmount !== null &&
                withdraw(selectedCardIndex(), transactionAmount)
            "
          >
            Withdraw
          </button>
        </div>
        <!-- ðŸ”„ Transfer Button SVG -->
        <div class="flex justify-start pl-10 pt-3 flex-row pr-3 mt-5 gap-5">
          <button
            class="hover:scale-110 transition bg-black/10 p-1 rounded-xl"
            (click)="showTransferLinkModal()"
          >
            <app-hand-holding-dollar
              class="w-8 h-8 text-white/50 hover:text-[#ff411f]"
            ></app-hand-holding-dollar>
          </button>
          <button
            (click)="toggleTransferSection()"
            class="hover:scale-110 transition bg-black/10 p-1 rounded-xl"
          >
            <app-card-transfer-bold
              class="w-8 h-8 text-white/50 hover:text-[#ff411f]"
            />
          </button>
        </div>
        <div *ngIf="showTransferSection()" class="mt-6">
          <h3 class="text-lg font-semibold text-[#ffffff] mb-2">
            Transfer To:
          </h3>

          <select
            [(ngModel)]="transferTargetIndex"
            class="w-full bg-[#323232] p-3 rounded-3xl text-[#ffffff] mb-5"
          >
            <option
              *ngFor="let card of cards(); let i = index"
              [value]="i"
              [disabled]="i === selectedCardIndex()"
            >
              {{ card.username }} - ${{ card.balance }}
            </option>
          </select>

          <input
            type="number"
            [(ngModel)]="transferAmount"
            placeholder="Amount"
            class="w-full bg-[#323232] p-2 text-center font-semibold text-xl rounded-3xl text-[#ffffff] mb-5"
          />

          <button
            class="w-full p-3 bg-[#191a19] text-white font-semibold shadow-md rounded-3xl transition-transform duration-300 hover:scale-105"
            (click)="transfer()"
          >
            Confirm Transfer
          </button>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- TOAST NOTIFICATION -->
  <div
    *ngIf="toastMessage()"
    class="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-black text-white px-4 py-2 rounded shadow-lg z-50 animate-fade-in"
  >
    {{ toastMessage() }}
  </div>

  <!-- ADD CARD MODAL -->
  <app-add-card-modal
    *ngIf="showModal()"
    [username]="user?.username"
    (save)="addCard($event)"
    (closeModal)="closeModal()"
  ></app-add-card-modal>

  @if(shouldShowTransferLinkModal) {
  <app-modal (closeModal)="closeTransferLinkModal()"></app-modal>
  }
</div>
